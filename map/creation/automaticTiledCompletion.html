This generator will HELP/SAVE YOU TIME to create the COLLISION layer.<br>
It is NOT MEANT to do it all, only about 90%.<br>
You will still need to complete the COLLISION layer in Tiled and make sure that everything is fine. (Especially Bridge, ladder)<br>
<br>
Select the .json file (Not the .tmx file)<br>
When saving in Tiled, choose ".json"<br>
<br>
Replace the content of the .json file with the one this generator will create. (Make backup first)<br>
The next time you open the project, load the .json file instead of the .tmx file.<br>
<br>
<div id="log"></div>
<input type="file" class="upload" onchange="readFiles(this.files)" multiple="" />
<div id="show"></div>
<script>
log = function(txt){ document.getElementById('log').innerHTML += txt + '<br>'; }
  

String.prototype.replaceAll = function (find, replace) {
    var str = this;
    return str.replace(new RegExp(find, 'g'), replace);
};

String.prototype.numberOnly = function(num){
	var sign = this[0] === '-';
	var a = this.replace(/[^\d.]/g, "");
	if(sign) a = '-' + a;
	if(num){ a = +a; }
	return a;
}
String.prototype.capitalize = function() {
	return this.charAt(0).toUpperCase() + this.slice(1);
}


readFiles = function(files) {
	for (var i in files) { //for multiple files          
		(function(file) {
			var reader = new FileReader();  
			
			reader.fileName = file.name;
			reader.onload = readFiles.script;
			reader.readAsText(file, "UTF-8");
			
			
		})(files[i]);
	}
}



readFiles.script = function(e) {  
	if(this.fileName.indexOf('.json') !== -1){
		log('You need to load the .json file, not the .tmx file.');
	}
	
	var name = this.fileName.slice(0,this.fileName.indexOf('.'));
	var content = JSON.parse(e.target.result); 	
	
	version = content.tilesets[0].image.slice(-10).slice(0,4);	//assumes tileset name is 1 digit
	
	//fix name
	for(var i in content.tilesets)
		content.tilesets[i].image = '..&#92;\/..&#92;\/..&#92;\/tileset&#92;\/' + version + '&#92;\/' + (+i+1) + '.png';
	
	//get collision layer
	for(var i in content.layers){
		if(content.layers[i].name === 'COLLISION')
			collisionLayer = content.layers[i];
		if(content.layers[i].name === 'ABOVE')
			aboveLayer = content.layers[i];
	}
	
	if(!collisionLayer || !aboveLayer){
		log('The layer "ABOVE" or the layer "COLLISION" is missing.');
		return;
	}
		
	
	
	for(var i in content.layers){
		for(var j in content.layers[i].data){
			var d = content.layers[i].data[j];
			
			if(convertChart[version].ab.list.indexOf(d) !== -1)
				collisionLayer.data[j] = convertChart[version].ab.code;
			if(convertChart[version].a.list.indexOf(d) !== -1)
				collisionLayer.data[j] = convertChart[version].a.code;	
			if(convertChart[version].fall.list.indexOf(d) !== -1)
				collisionLayer.data[j] = convertChart[version].fall.code;	
			if(convertChart[version].fallclose.list.indexOf(d) !== -1)
				collisionLayer.data[j] = convertChart[version].fallclose.code;	
				
			if(convertChart[version].above.list.indexOf(d) !== -1)
				aboveLayer.data[j] = d;
		}
	}
	
	document.getElementById('show').innerHTML = '<TEXTAREA>' + JSON.stringify(content) + '</TEXTAREA>';
}



convertChart = {
	'v1.1':{"ab":{"code":20001,"list":[10105,10106,10107,10108,10109,10110,10111,10112,10359,10360,10361,10362,10509,10510,10511,10512,10709,10710,10711,10712,10859,10860,10861,10862,10213,10214,10015,10016,10017,10313,10314,10305,10306,10257,10258,10315,10316,10317,10318,10717,10718,10719,10720,10155,10156,10157,10158,10159,10160,10161,10162,10409,10410,10411,10412,10559,10560,10561,10562,10759,10263,10264,10065,10066,10067,10363,10364,10355,10356,10307,10308,10365,10366,10367,10368,10767,10768,10769,10770,10205,10206,10207,10208,10209,10210,10211,10212,10459,10460,10461,10462,10609,10610,10611,10612,10809,10115,10116,10117,10013,10014,10113,10114,10415,10416,10417,10418,10817,10818,10819,10820,10659,10660,10661,10662,10165,10166,10167,10063,10064,10163,10164,10465,10466,10467,10468,10865,10866,10867,10868,10869,10870,10871,10872,10515,10516,10517,10518,10915,10916,10917,10918,10919,10920,10921,10922,10565,10566,10567,10568,10965,10966,10967,10968,10969,10970,10971,10972,5351,5352,5353,5354,5356,5008,5004,5006,5562,5566,5808,5809,5810,5811,5812,12561,12562,12563,12855,12856,12601,12602,12603,12808,12809,12810,12608,5201,5202,5203,5207,5211,5001,5003,11017,11018,11019,11020,5451,5452,5453,5404,5406,5058,5054,5056,5612,5616,5858,5859,5860,5861,5862,12611,12612,12613,12905,12906,12651,12652,12653,12858,12859,12860,12801,12659,12660,12658,5301,5302,5303,5257,5261,5051,5053,11067,11068,11069,11070,5454,5456,5108,5104,5106,5908,5909,5910,12661,12662,12663,12908,12909,12910,12851,12709,12710,12708,5204,5205,5206,5307,5311,5101,5103,11117,11118,11119,11120,5158,12711,12712,12713,12759,12760,5304,5305,5306,12761,12762,12763,12508,12509,5412,5413,5414,12861,12862,12863,12864,12811,12812,12813,12558,12559,5462,5463,5464,12911,12912,12913,12914,5013,5014,5015,5170,5171,5172,5173,5174,5175,5176,5177,5178,12961,12962,12963,12964,5062,5063,5064,5065,5066,5219,5220,5221,5222,5223,5224,5225,5226,5227,5228,5229,13011,13012,13013,13014,5112,5113,5115,5116,13001,13002,13003,13004,12802,12803,5269,5270,5271,5272,5273,5274,5275,5276,5277,5278,5279,13061,13062,13063,5162,5166,13051,13052,13053,13054,12852,12853,5319,5320,5328,5329,5212,5216,5369,5379,5262,5263,5265,5266,5419,5420,5428,5429,5312,5313,5314,5315,5316,5469,5470,5471,5477,5478,5479,5363,5364,5365,5519,5520,5521,5522,5526,5527,5528,5529,5570,5571,5572,5576,5577,5578,3004,3005,3006,3014,3015,3016,2561,2562,2563,2553,2554,2555,3604,3610,3611,3612,2523,2524,2528,2529,3053,3054,3055,3056,3057,3063,3064,3065,3066,3067,2610,2614,2602,2603,2604,2605,2606,3653,3655,3659,3663,2574,2578,3102,3103,3104,3105,3106,3107,3108,3112,3113,3117,3118,2659,2665,2652,2656,3702,3706,3709,3710,3712,3713,2624,2628,3152,3153,3154,3155,3156,3157,3158,3161,3162,3168,3169,2709,2710,2714,2715,2702,2706,3752,3753,3755,3756,3759,3760,3761,3762,3763,2674,2675,2676,2677,2678,3202,3203,3207,3208,3211,3212,3218,3219,2760,2761,2763,2764,2752,2756,3803,3804,3805,3810,3811,3812,2724,2725,2726,2727,2728,3252,3253,3257,3258,3261,3262,3213,3217,3268,3269,2811,2812,2813,2803,2804,2805,3854,2774,2775,2776,2777,2778,3302,3303,3307,3308,3312,3263,3264,3266,3267,3318,2862,2824,2825,2827,2828,3353,3354,3355,3356,3357,3313,3314,3315,3316,3317,2873,2874,2875,2877,2878,2879,3404,3405,3406,3363,3364,3365,3366,3367,2922,2923,2924,2925,2927,2928,2929,2930,3414,3415,3416,2972,2973,2974,2978,2979,2980,3465,3022,3023,3029,3030,3072,3080]},"a":{"code":20051,"list":[1001,1002,1003,1004,1005,606,657,655,611,660,661,662,2568,2569,2570,1051,1052,1053,1054,1055,656,608,609,661,613,614,2617,2618,2619,2620,2621,1101,1102,1103,1104,1105,706,658,659,711,663,664,2667,2668,2669,2670,2671,1151,1152,1153,1154,1155,2717,2718,2719,2720,2721,1201,1202,1203,1204,1205,2768,2769,2770,2525,2526,2527,2575,2576,2577,2625,2626,2627]},"above":{"list":[5512,5513,5514,5515,5516,5422,5423,5424,5425,5426,5472,5476,10005,10006,10007,10008,10255,10256,10009,10010,10011,10012,10259,10260,10261,10262,10215,10216,10217,10218,10617,10618,10619,10620,10270,10271,10019,10020,10055,10056,10057,10058,10059,10060,10061,10062,10309,10310,10311,10312,10265,10266,10267,10268,10667,10668,10669,10670,10765,10766,10771,10772,10369,10372,10815,10816,10821,10822,12901,12902,12903,12904,12951,12952,12953,12954]},"fall":{'code':20061,"list":[1207,1208,1257,1258]},"fallclose":{'code':20011,"list":[1156,1157,1158,1159,1206,1209,1256,1259,1306,1307,1308,1309]}},
}




</script>